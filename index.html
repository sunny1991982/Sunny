<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sunny Shop - Official Store</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #1a3a5f; --accent: #d4af37; --bg: #f4f7f9; --white: #ffffff; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding-bottom: 50px; }
        header { background: var(--primary); color: var(--white); padding: 1rem 5%; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .container { padding: 2rem 5%; max-width: 1200px; margin: auto; }
        .hidden { display: none; }
        
        /* Product Card UI */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .product-card { background: var(--white); border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-top: 5px solid var(--accent); transition: 0.3s; }
        .product-card:hover { transform: translateY(-5px); }
        .product-card h3 { margin: 10px 0; color: var(--primary); }
        .price { font-size: 1.4rem; font-weight: bold; color: #c0392b; margin: 10px 0; }
        
        /* Forms & Buttons */
        input, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        .btn { cursor: pointer; padding: 12px 24px; border: none; border-radius: 6px; font-weight: bold; transition: 0.3s; width: 100%; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-accent { background: var(--accent); color: var(--primary); }
        .btn-secondary { background: #e0e0e0; color: #333; margin-top: 10px; }

        /* Cart Icon */
        .cart-icon { position: relative; cursor: pointer; font-size: 1.8rem; }
        #cart-count { position: absolute; top: -5px; right: -5px; background: var(--accent); color: var(--primary); border-radius: 50%; padding: 2px 7px; font-size: 0.8rem; font-weight: bold; }

        /* Popup Modal */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; }
    </style>
</head>
<body>

<header>
    <h1 style="margin:0;"><i class="fas fa-sun"></i> Sunny Shop</h1>
    <div style="display: flex; align-items: center; gap: 20px;">
        <button class="btn btn-accent" style="width:auto; padding: 8px 15px;" onclick="checkAdmin()">Admin</button>
        <span class="cart-icon" onclick="openCart()">
            <i class="fas fa-shopping-cart"></i>
            <span id="cart-count">0</span>
        </span>
    </div>
</header>

<div class="container">
    <section id="view-shop">
        <h2 style="text-align: center; color: var(--primary); margin-bottom: 30px;">สินค้าแนะนำสำหรับคุณ</h2>
        <div id="product-display" class="product-grid">กำลังโหลดสินค้าจากระบบกลาง...</div>
    </section>

    <section id="view-checkout" class="hidden">
        <div style="max-width: 600px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
            <h2><i class="fas fa-truck"></i> ข้อมูลการจัดส่ง</h2>
            <input type="text" id="ship-name" placeholder="ชื่อ-นามสกุล ผู้รับ">
            <textarea id="ship-address" placeholder="ที่อยู่จัดส่งโดยละเอียด" rows="4"></textarea>
            <input type="tel" id="ship-phone" placeholder="เบอร์โทรศัพท์ติดต่อ">
            <button class="btn btn-primary" onclick="processOrder()">ยืนยันสั่งซื้อสินค้า</button>
            <button class="btn btn-secondary" onclick="showView('view-shop')">ย้อนกลับ</button>
        </div>
    </section>

    <section id="view-admin" class="hidden">
        <div style="max-width: 600px; margin: auto; background: white; padding: 30px; border-radius: 12px;">
            <h2>ระบบหลังบ้าน</h2>
            <p>เพิ่มสินค้าใหม่เข้าระบบกลาง</p>
            <input type="text" id="new-p-name" placeholder="ชื่อสินค้า">
            <input type="number" id="new-p-price" placeholder="ราคา (บาท)">
            <button class="btn btn-primary" onclick="saveProduct()">บันทึกสินค้า</button>
            <button class="btn btn-secondary" onclick="showView('view-shop')">ออกจากหน้า Admin</button>
        </div>
    </section>
</div>

<div id="cart-modal" class="modal hidden">
    <div class="modal-content">
        <h3><i class="fas fa-shopping-basket"></i> ตะกร้าของคุณ</h3>
        <div id="cart-list" style="margin: 20px 0;"></div>
        <hr>
        <h4 id="cart-total" style="text-align: right; color: #c0392b;"></h4>
        <button class="btn btn-primary" onclick="goToCheckout()">ชำระเงิน</button>
        <button class="btn btn-secondary" onclick="closeCart()">เลือกสินค้าเพิ่ม</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    // การตั้งค่า Firebase ของคุณ
    const firebaseConfig = {
        apiKey: "AIzaSyB2MNzL1-w1AxW5taQvyvTFJO4GkL4ucis",
        authDomain: "sunny-shop-fc134.firebaseapp.com",
        projectId: "sunny-shop-fc134",
        storageBucket: "sunny-shop-fc134.firebasestorage.app",
        messagingSenderId: "126433516060",
        appId: "1:126433516060:web:dbc327c35a330a06271dd9",
        databaseURL: "https://sunny-shop-fc134-default-rtdb.asia-southeast1.firebasedatabase.app"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const productsRef = ref(db, 'products');

    let allProducts = [];
    let myCart = [];

    // ดึงข้อมูลสินค้าแบบ Real-time
    onValue(productsRef, (snapshot) => {
        const data = snapshot.val();
        allProducts = data ? Object.entries(data).map(([id, val]) => ({ id, ...val })) : [];
        renderProducts();
    });

    window.renderProducts = () => {
        const display = document.getElementById('product-display');
        if (allProducts.length === 0) { display.innerHTML = "<p>ยังไม่มีสินค้าในร้าน</p>"; return; }
        
        display.innerHTML = allProducts.map(p => `
            <div class="product-card">
                <h3>${p.name}</h3>
                <p class="price">฿${p.price.toLocaleString()}</p>
                <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px;">
                    <input type="checkbox" id="chk-${p.id}" style="width:20px; height:20px;"> <b>เลือกรายการ</b>
                    <input type="number" id="qty-${p.id}" value="1" min="1" style="width:70px; margin:0;">
                </div>
                <button class="btn btn-primary" onclick="addToCart('${p.id}')">ใส่ตะกร้า</button>
            </div>
        `).join('');
    };

    window.saveProduct = () => {
        const name = document.getElementById('new-p-name').value;
        const price = document.getElementById('new-p-price').value;
        if(name && price) {
            push(productsRef, { name, price: parseFloat(price) });
            alert("บันทึกสินค้าเรียบร้อย!");
            document.getElementById('new-p-name').value = '';
            document.getElementById('new-p-price').value = '';
        }
    };

    window.addToCart = (id) => {
        const chk = document.getElementById(`chk-${id}`);
        const qty = parseInt(document.getElementById(`qty-${id}`).value);
        if(!chk.checked) return alert("โปรดติ๊กถูกที่ช่องเลือกสินค้าก่อนครับ");
        
        const product = allProducts.find(p => p.id === id);
        const inCart = myCart.find(item => item.id === id);
        
        if(inCart) inCart.qty += qty;
        else myCart.push({ ...product, qty });
        
        updateCartUI();
        alert("เพิ่มสินค้าลงตะกร้าแล้ว!");
    };

    window.updateCartUI = () => {
        document.getElementById('cart-count').innerText = myCart.reduce((s, i) => s + i.qty, 0);
    };

    window.openCart = () => {
        const list = document.getElementById('cart-list');
        let total = 0;
        list.innerHTML = myCart.map(item => {
            total += item.price * item.qty;
            return `<div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <span>${item.name} x ${item.qty}</span>
                        <span>฿${(item.price * item.qty).toLocaleString()}</span>
                    </div>`;
        }).join('') || "ตะกร้าว่างเปล่า";
        document.getElementById('cart-total').innerText = "รวมเงินทั้งสิ้น: ฿" + total.toLocaleString();
        document.getElementById('cart-modal').classList.remove('hidden');
    };

    window.closeCart = () => document.getElementById('cart-modal').classList.add('hidden');
    
    window.showView = (id) => {
        document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    };

    window.checkAdmin = () => {
        if(prompt("กรุณาใส่รหัสผ่านแอดมิน:") === "19911217") showView('view-admin');
        else alert("รหัสผ่านไม่ถูกต้อง");
    };

    window.goToCheckout = () => {
        if(myCart.length === 0) return alert("กรุณาเลือกสินค้าก่อน");
        closeCart();
        showView('view-checkout');
    };

    window.processOrder = () => {
        const name = document.getElementById('ship-name').value;
        if(!name) return alert("กรุณากรอกชื่อผู้รับ");
        const orderId = "SUN-" + Date.now().toString().slice(-6);
        alert(`สั่งซื้อสำเร็จ!\nหมายเลขสั่งซื้อ: ${orderId}\nขอบคุณที่ใช้บริการ Sunny Shop`);
        myCart = [];
        updateCartUI();
        showView('view-shop');
    };
</script>
</body>
                                                                                                        </html>
    
